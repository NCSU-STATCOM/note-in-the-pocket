---
title: "item_plots_agg"
author: "Hyoshin Kim"
date: '2022 3 10 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
```

### Read in cleaned, aggregated data

```{r}
setwd("D:/GitHub/note-in-the-pocket")
orders_agg_df <- readRDS("intermediary_data/orders_allyears_agg_received.rds")
```

```{r}
### Rename `Date Received`
orders_agg_df <- orders_agg_df %>%
  rename(date_received = `Date Received`)
orders_agg_df$date_received <- lubridate::as_date(orders_agg_df$date_received)
```

### Months with the most requests received, requests filled.

```{r}
# Table_df <- orders_agg_df %>% drop_na()
# recv_date <- lubridate::as_date(Table_df$date_received)
# fill_date <- lubridate::as_date(Table_df$earliest_filled)
# Table_recv <- table(lubridate::month(recv_date)) %>% 
#   data.frame() %>% 
#   rename(recv_date = Var1) %>%
#   arrange(desc(Freq)) 
# Table_fill <- table(lubridate::month(fill_date)) %>% 
#   data.frame() %>% 
#   rename(fill_date = Var1) %>%
#   arrange(desc(Freq)) 
```

```{r}
# ggplot() +
#   geom_point(aes(recv_date, Freq, color = "red"), data = Table_recv) +
#   geom_point(aes(fill_date, Freq, color = "blue"), data = Table_fill) +
#   scale_color_manual(labels = c("Earliest Filled", "Received"), values = c("blue", "red"))
```


### Plot of items by date

```{r, echo=FALSE, eval = FALSE}
#"Acc",
#"gt", "gb", "gu", "gs", "gc",
#"bt", "bb", "bu", "bs", "bc",
#"wt", "wb", "wu", "ws", "wc",
#"mt", "mb", "mu", "ms", "mc",
# pg <- ggarrange(gt_plot,
#           gb_plot,
#           gu_plot,
#           gs_plot,
#           gc_plot)
# pb <- ggarrange(bt_plot,
#                 bb_plot,
#                 bu_plot,
#                 bs_plot,
#                 bc_plot)
# pw <- ggarrange(wt_plot,
#                 wb_plot,
#                 wu_plot,
#                 ws_plot,
#                 wc_plot)
# pm <- ggarrange(mt_plot,
#                 mb_plot,
#                 mu_plot,
#                 ms_plot,
#                 mc_plot)
```

```{r}
items_List <- c("num_requests",
                "female_small", "female_large",
                "male_small", "male_large")

for (item in items_List) {
  plot_item <- str_c(item, "_plot")
  title <- str_replace(item, "_", " ")
  assign(plot_item, 
         ggplot(data = orders_agg_df,
                aes_string(x = "date_received", y = item)) +
           theme_bw() +
           geom_point() +
           geom_line() +
           xlab("date received") +
           ylab("number of requests") +
           ggtitle(str_to_title(title)) +
           geom_smooth(method = "loess"))
}
```

```{r, message = FALSE}
num_requests_plot
```

```{r, message = FALSE}
female_small_plot
```

```{r, message = FALSE}
male_small_plot
```

```{r, message = FALSE}
female_large_plot
```

```{r, message = FALSE}
male_large_plot
```


- Based on the time plots for each clothing item (female small, male small, female large, male large), there is a recurring pattern each year. A small peak in spring, and a larger peak in fall, presumably reflecting the start of school semester. 

- The small peak in spring is less apparent in 2020 for all clothing items, because of COVID starting around that time of year. 

### Plot of Total Number of Requests and Student Status

```{r}
status_df <- orders_agg_df %>%
  dplyr::select(date_received, num_requests, student, NonStudent)
status_df_long <- gather(status_df, status, num, 
                         num_requests, student, NonStudent)

ggplot(data = status_df_long,
                aes(x = date_received, y = num, colour = status)) +
           theme_bw() +
           geom_point() +
           geom_line() +
           xlab("date received") +
           ylab("number of requests") +
           ggtitle("Total Number of Requests and Student Status")
```
### Plot of 

